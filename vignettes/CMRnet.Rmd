---
title: "CMRnet"
author: "Matthew Silk"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{CMRnet}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

#### An introduction on how to use CMRnet to create, analyse and plot networks from capture, mark, recapture data 

***

```{r load_packages}
# load packages
library(profvis)
library(CMRnet)

```

**CMRnet** comes with three example datasets loaded which help demonstrate how data should be organised when using **CMRnet** and how the functions work. In this vignette we will use these example dataset to demonstrate the functions of **CMRnet**.

```{r load_datasets}
# load in data
data(cmrData)
data(cmrData2)
data(cmrData3)

# look at the datasets
str(cmrData)
str(cmrData2)
str(cmrData3)

```

#### 1. Creating networks from mark-recpature data

A principal aim of the package is to facilitate the construction of networks from mark-recapture data. **CMRnet** can be used to construct two types of social network:

1. Co-capture (social) networks. These networks connect two individuals that have been captured at the same location (or close by) within a pre-defined time interval
2. Movement networks. These networks connect two locations that an individual has been trapped at with a directed edge. **CMRnet** enables movement networks to be constructed as multiplex networks in which different layers represent the movements of different types of individual (female vs. male, different age classes etc.)

In both co-capture and movement networks, the package allows the use of either date or date/time information to construct social networks. The former will be applicable to most types of mark-recapture data, but the latter will be useful when capture events occur at much higher resolutions.

***

First we construct co-capture networks using the the normal and high resolution versions of the co-capture network function. The normal version `DynamicNetCreate()` defines the interval window in days. 

```{r cocap_net}

# Set parameters for the function ####

# Start Date
mindate <- "2010-01-01"
# End Date
maxdate <- "2015-01-01"
# Length of time in days within which individuals are considered to be co-captured
intwindow <- 60
# Length of each network window in months. We will use 5 12-month windows in this example
netwindow <- 12
# Overlap between network windows in months (we have no overlap in this example)
overlap <- 0
# Spatial tolerance for defining co-captures. Captures within a threshold distance (rather than simply at the same location) are considered when this is set to be greater than zero
spacewindow <- 0

# Create co-capture (social) networks ####
# index=FALSE indicates that we want edges to be weighted by the number of movements (see help pages for the alternative)
netdat <- DynamicNetCreate(
    data = cmrData,
    intwindow = intwindow,
    mindate = mindate,
    maxdate = maxdate,
    netwindow = netwindow,
    overlap = overlap,
    spacewindow = spacewindow,
    index=FALSE
  )

```
```
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
```

The high resolution `DynamicNetCreateHi` sets the interval window in minutes.

```{r cocap_net_hi}

# Set parameters for the function ####
mindate <- "2019-12-01 00:00:00"
maxdate <- "2020-07-01 00:00:00"
# The interaction window is now in minutes. We set it to be one day here.
intwindow <- 24*60
# The network window is now in days
netwindow <- 20
# The overlap is now also in days
overlap <- 2
spacewindow <- 0

## Create high-resolution co-capture (social) networks
netdat_hi<-DynamicNetCreateHi(
  data=cmrData3,
  intwindow=intwindow,
  mindate=mindate,
  maxdate=maxdate,
  netwindow=netwindow,
  overlap=overlap,
  spacewindow=spacewindow,
  index=FALSE)

```

```
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
```

***

Next we do the same for the creation of single layer movement networks using `MoveNetCreate` and `MoveNetCreateHi`.

```{r movement_net}

# Set parameters for the function ####

#Start Date
mindate <- "2010-01-01"
# End Date
maxdate <- "2015-01-01"
# Length of time in days within which individuals are considered to be co-captured
intwindow <- 60
# Length of each network window in months. We will use 5 12-month windows in this example
netwindow <- 12
# Overlap between network windows in months (we have no overlap in this example)
overlap <- 0

# Generate movement network
# nextonly=TRUE indicates that only direct movements between groups should be considered (see help pages)
movenetdat <- MoveNetCreate(
  data = cmrData,
  intwindow = intwindow,
  mindate = mindate,
  maxdate = maxdate,
  netwindow = netwindow,
  overlap = overlap,
  nextonly = TRUE,
  index=FALSE
)

```
```
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
```

Again the high resolution `MoveNetCreateHi` defines the interval window in minutes.

```{r movement_net_hi}

# Set parameters for the function ####
mindate <- "2019-12-01 00:00:00"
maxdate <- "2020-07-01 00:00:00"
# Interaction window is now in minutes
intwindow <- 30*24*60
# The network window is now in days
netwindow <- 60
#The overlap is now also in days
overlap <- 0
spacewindow <- 0

# Generate movement network
# nextonly=TRUE indicates that only direct movements between groups should be considered (see help pages)
movenetdat <- MoveNetCreateHi(
  data = cmrData3,
  intwindow = intwindow,
  mindate = mindate,
  maxdate = maxdate,
  netwindow = netwindow,
  overlap = overlap,
  nextonly = TRUE,
  index=FALSE
)

```
```
[==================================================================] 100%
[==================================================================] 100%
[==================================================================] 100%
```
***

Next we construct multiplex movement networks using the standard function to show how to use the alternative data format. These networks are useful when there are multiple layered movement networks (i.e. a separate network for males and females).

```{r multiplex}
#Start Date
mindate <- "2010-01-01"
# End Date
maxdate <- "2015-01-01"
# Length of time in days within which individuals are considered to be co-captured
intwindow <- 60
# Length of each network window in months. We will use 5 12-month windows in this example
netwindow <- 12
# Overlap between network windows in months (we have no overlap in this example)
overlap <- 0

# Generate multiplex movement network
multimovenetdat <-
  MultiMoveNetCreate(
    data = cmrData2,
    intwindow = intwindow,
    mindate = mindate,
    maxdate = maxdate,
    netwindow = netwindow,
    overlap = overlap,
    nextonly = TRUE,
    index=FALSE
  )


```
